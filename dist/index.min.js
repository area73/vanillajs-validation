!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("underscore")):"function"==typeof define&&define.amd?define(["exports","underscore"],b):b(a.index={},a._)}(this,function(b,d){"use strict";d=d&&d.hasOwnProperty("default")?d.default:d;var e={cep:"CEP inv\xE1lido.",cpf:"CPF inv\xE1lido.",cnpj:"CNPJ inv\xE1lido.",digits:"Apenas d\xEDgitos permitidos.",email:"Email inv\xE1lido.",required:"Campo obrigat\xF3rio.",minlength:function(a){return"O campo deve ter no minimo "+a+" caracteres"},maxlength:function(a){return"O campo deve ter no m\xE1ximo "+a+" caracteres"}},f=["00000000000","11111111111","22222222222","33333333333","44444444444","55555555555","66666666666","77777777777","88888888888","99999999999"],g=function(a){var b=a.toString().replace(/\D/g,"");return 11==b.length&&!f.includes(b)&&function(a){var b,c,d,e,f;for(f=1,e=0;e<a.length-1;e++)if(a.charAt(e)!=a.charAt(e+1)){f=0;break}if(f)return!1;for(b=a.substring(0,9),c=a.substring(9),d=0,e=10;1<e;e--)d+=b.charAt(10-e)*e;if((2>d%11?0:11-d%11)!=c.charAt(0))return!1;for(b=a.substring(0,10),d=0,e=11;1<e;e--)d+=b.charAt(11-e)*e;return(2>d%11?0:11-d%11)==c.charAt(1)}(b)},h=function(b){if(""==(b=b.replace(/[^\d]+/g,"")))return!1;if(14!=b.length)return!1;if("00000000000000"==b||"11111111111111"==b||"22222222222222"==b||"33333333333333"==b||"44444444444444"==b||"55555555555555"==b||"66666666666666"==b||"77777777777777"==b||"88888888888888"==b||"99999999999999"==b)return!1;for(var c=b.length-2,d=b.substring(0,c),f=b.substring(c),g=0,h=c-7,i=c;1<=i;i--)g+=d.charAt(c-i)*h--,2>h&&(h=9);var j=2>g%11?0:11-g%11;if(j!=f.charAt(0))return!1;c+=1,d=b.substring(0,c),g=0,h=c-7;for(var k=c;1<=k;k--)g+=d.charAt(c-k)*h--,2>h&&(h=9);return(j=2>g%11?0:11-g%11)==f.charAt(1)},i={cep:function(a){return /^[0-9]{5}(?:-[0-9]{3})?$/.test(a)},cpf:function(a){return g(a)},cnpj:function(a){return h(a)},email:function(a){return /^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(a)},equalTo:function(a,b){var c=this.form.querySelector(b);return!!c&&a===c.value},digits:function(a){return /^[0-9]*$/.test(a)},required:function(a,b){return a&&b},minlength:function(a,b){return 1<=b&&a.length>=b},maxlength:function(a,b){return 1<=b&&a.length<=b}},j=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),k=e,m=i,l=function(){function a(b,c){!function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}(this,a),this.form=b,this.formInputs=[],this.customRules=c.customRules?c.customRules:{},this.validationMessages=k,this.validationHandlers=m,this.submitEventIntercept=c.submitEventIntercept?c.submitEventIntercept:null,this.fieldHolderSelector=c.fieldHolderSelector?c.fieldHolderSelector:"[data-field-holder]",this.rules=c.rules?c.rules:{},this.errorList=[],this.errorClass=c.errorClass?c.errorClass:"invalid",this.messages=c.messages?c.messages:{},this.onfocusout=c.onfocusout?c.onfocusout:null,this.beforeErrorPlacement=c.beforeErrorPlacement?c.beforeErrorPlacement:null,this.errorPlacement=c.errorPlacement?c.errorPlacement:null,this.submitHandler=c.submitHandler?c.submitHandler:null,this.invalidHandler=c.invalidHandler?c.invalidHandler:null,this.submitListenerHandler=this.onSubmit.bind(this),this.rules||this.setupRules(),this.listInputs(),this.init()}return j(a,[{key:"addCustomRule",value:function(a,b){if(!this.customRules[a]){if("function"!=typeof b)throw new Error("The second param to \"addCustomRule\" should be a function!");this.customRules[a]=b}}},{key:"addCustomRuleMessage",value:function(a,b){if(!this.validationMessages[a]){if("string"!=typeof b&&"function"!=typeof b)throw new Error("The second param to \"addCustomRuleMessage\" should be a string or a function!");this.validationMessages[a]=b}}},{key:"addError",value:function(a,b){a.classList.contains(this.errorClass)||(a.classList.add(this.errorClass),b.setAttribute("aria-invalid","true"))}},{key:"addErrorMessage",value:function(a,b){var c=a.errField,d=this.getError(b,a.el.name);c.innerHTML&&"required"!==d.rule||(c.dataset.inputError=d.rule,c.innerHTML=d.message)}},{key:"clearError",value:function(b,c){var e=d.findIndex(this.errorList,{rule:c,inputIndex:b});if("number"==typeof e){var f=this.formInputs[b];this.removeError(f.holder,f.el),a.removeErrorMessage(f.errField),this.errorList.splice(e,1)}}},{key:"clearErrors",value:function(){var b=this;this.errorPlacement||this.errorList.forEach(function(c){var d=b.formInputs[c.inputIndex],e=d.el,f=d.holder;b.removeError(f,e),a.removeErrorMessage(d.errField)}),this.errorList=[]}},{key:"destroy",value:function(){return this.form.removeEventListener("submit",this.submitListenerHandler),this.clearErrors(),this.formInputs=[],null}},{key:"getError",value:function(a){var b={rule:a.rule};return b.message="function"==typeof this.validationMessages[a.rule]?this.validationMessages[a.rule](a.required):this.validationMessages[a.rule],this.messages&&this.messages[a.el.name]&&this.messages[a.el.name][a.rule]&&(b.message=this.messages[a.el.name][a.rule]),b}},{key:"listInputs",value:function(){var a=this,b=this;Array.from(this.form.querySelectorAll(this.fieldHolderSelector)).forEach(function(c){var d=c.querySelector("input:not([disabled])")||c.querySelector("textarea:not([disabled])");if(d&&a.rules[d.name]){var e={el:d,errField:c.querySelector("[data-field-error]"),holder:c,rules:"required"===b.rules[d.name]?{required:!0}:b.rules[d.name],valid:null};a.formInputs.push(e)}})}},{key:"mapErrors",value:function(){var a=this;this.errorPlacement?this.mapForErrorPlacement():this.errorList.forEach(function(b){var c=a.formInputs[b.inputIndex],d=c.el,e=c.holder;a.addError(e,d),a.addErrorMessage(c,b)})}},{key:"mapForErrorPlacement",value:function(){var a=this,b=[];this.formInputs.forEach(function(c){var e=d.where(a.errorList,{el:c.el});if(e.length){var f=d.where(e,{rule:"required"});f.length?b.push(f[0]):b.push(e[0])}}),this.beforeErrorPlacement&&this.beforeErrorPlacement.call(this,this),b.forEach(function(b){a.errorPlacement.call(a,a.getError(b),b.el)})}},{key:"onSubmit",value:function(a){a.preventDefault(),this.submitEventIntercept&&this.submitEventIntercept.call(this,a,this),this.validate().hasError?this.invalidHandler&&this.invalidHandler.call(this,this):this.submitHandler?this.submitHandler.call(this,this.form):a.currentTarget.submit()}},{key:"removeError",value:function(a,b){a.classList.contains(this.errorClass)&&(b.setAttribute("aria-invalid","false"),a.classList.remove(this.errorClass))}},{key:"validateInput",value:function(a,b,c){var f=this,g=a,h=b;if(!b&&"number"!=typeof b){var e=d.findIndex(this.formInputs,{el:g});g=this.formInputs[e],h=e}return Object.entries(g.rules).forEach(function(a){var b=d.findIndex(f.errorList,{el:g.el,rule:a[0],inputIndex:h}),c=d.findIndex(f.errorList,{el:g.el,inputIndex:h});f.validateValue(g.el.value,a[0],a[1])?(0<=b&&f.clearError(h,a[0]),0>c&&(g.valid=!0)):0>b&&(g.valid=!1,f.errorList.push({el:g.el,rule:a[0],required:a[1],inputIndex:h}))}),"function"==typeof c&&c(),g}},{key:"validateValue",value:function(a,b,c){if(this.validationHandlers[b])return this.validationHandlers[b].call(this,a,c);if(this.customRules[b])return this.customRules[b].call(this,a,c);throw new Error("Undefined rule "+b+".")}},{key:"validate",value:function(){return this.formInputs=this.formInputs.map(this.validateInput.bind(this)),0<this.errorList.length?(this.mapErrors(),{hasError:!0,errorCount:this.errorList.length}):{hasError:!1}}},{key:"setupListeners",value:function(a){var b=this,c=this;Array.from(this.form.querySelectorAll(this.fieldHolderSelector)).forEach(function(f){var e=f.querySelector("input:not([disabled])");0<=d.findIndex(b.formInputs,{el:e})&&e.addEventListener(a,c.validateInput.bind(c,e,null,function(){0<c.errorList.length&&c.mapErrors()}))})}},{key:"init",value:function(){this.form.addEventListener("submit",this.submitListenerHandler),this.onfocusout&&this.setupListeners("focusout"),this.onkeypress&&this.setupListeners("keypress")}}],[{key:"removeErrorMessage",value:function(a){a&&a.innerHTML&&a.dataset.inputError&&(a.innerHTML="",a.dataset.inputError="")}}]),a}();b.default=l,b.defaultMessages=e,b.validationRules=i,Object.defineProperty(b,"__esModule",{value:!0})});
