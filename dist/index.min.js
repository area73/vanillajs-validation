!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("underscore")):"function"==typeof define&&define.amd?define(["underscore"],b):a.index=b(a._)}(this,function(b){"use strict";function g(a){var b=2,c=a.split("").reduce(function(a,b){return[parseInt(b,10)].concat(a)},[]).reduce(function(a,c){return a+=c*b,b=9==b?2:b+1,a},0)%11;return 2>c?0:11-c}b=b&&b.hasOwnProperty("default")?b.default:b;var f={cep:"CEP inv\xE1lido.",cpf:"CPF inv\xE1lido.",cnpj:"CNPJ inv\xE1lido.",digits:"Apenas d\xEDgitos permitidos.",email:"Email inv\xE1lido.",required:"Campo obrigat\xF3rio.",minlength:function(a){return"O campo deve ter no minimo "+a+" caracteres"},maxlength:function(a){return"O campo deve ter no m\xE1ximo "+a+" caracteres"}},h=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=["00000000000","11111111111","22222222222","33333333333","44444444444","55555555555","66666666666","77777777777","88888888888","99999999999"],k=function(a){var b=a.length+1,c=a.map(function(a,c){return a*(b-c)}).reduce(function(a,b){return a+b})%11;return 1>=c?0:11-c},i=function(a){var b=a.toString().replace(/\D/g,"");if(11!=b.length||j.includes(b))return!1;var c=b.split("").map(function(a){return parseInt(a,10)}),d=c.slice(0,9),e=c.slice(9,2),f=k(d);return[f,k([].concat(function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(d),[f]))].join==e.join},m=["00000000000000","11111111111111","22222222222222","33333333333333","44444444444444","55555555555555","66666666666666","77777777777777","88888888888888","99999999999999"],o=/[-\/.]/g,l=/[^\d]/g,c=function(a,b){var c,d=(c=b?o:l,(a||"").toString().replace(c,""));if(!d)return!1;if(14!==d.length)return!1;if(m.includes(d))return!1;var e=d.substr(0,12);return e+=g(e),(e+=g(e)).substr(-2)===d.substr(-2)},n={cep:function(a){return /^[0-9]{5}(?:-[0-9]{3})?$/.test(a)},cpf:function(a){return i(a)},cnpj:function(a){return c(a)},email:function(a){return /^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(a)},equalTo:function(a,b){var c=this.form.querySelector(b);return!!c&&a===c.value},digits:function(a){return /^[0-9]*$/.test(a)},required:function(a,b){return a&&b},minlength:function(a,b){return 1<=b&&a.length>=b},maxlength:function(a,b){return 1<=b&&a.length<=b}};return function(){function a(b,c){!function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}(this,a),this.form=b,this.formInputs=[],this.rules=c.rules?c.rules:{},this.errorList=[],this.errorClass=c.errorClass?c.errorClass:"invalid",this.messages=c.messages?c.messages:{},this.onfocusout=c.onfocusout?c.onfocusout:null,this.errorPlacement=c.errorPlacement?c.errorPlacement:null,this.submitHandler=c.submitHandler?c.submitHandler:null,this.invalidHandler=c.invalidHandler?c.invalidHandler:null,this.rules||this.setupRules(),this.listInputs(),this.setup()}return h(a,[{key:"addErrorClass",value:function(a){a.classList.contains(this.errorClass)||a.classList.add(this.errorClass)}},{key:"addErrorMessage",value:function(a,b){var c=a.errField,d=this.getError(b,a.el.name);c.innerHTML&&"required"!==d.rule||(c.dataset.inputError=d.rule,c.innerHTML=d.message)}},{key:"clearError",value:function(c,d){var e=b.findIndex(this.errorList,{rule:d,inputIndex:c});if("number"==typeof e){var f=this.formInputs[c];this.removeErrorClass(f.holder),a.removeErrorMessage(f.errField),this.errorList.splice(e,1)}}},{key:"getError",value:function(a){var b={rule:a.rule};return b.message="function"==typeof f[a.rule]?f[a.rule](a.required):f[a.rule],this.messages&&this.messages[a.el.name]&&this.messages[a.el.name][a.rule]&&(b.message=this.messages[a.el.name][a.rule]),b}},{key:"listInputs",value:function(){var a=this,b=this;Array.from(this.form.querySelectorAll("[data-field-holder]")).forEach(function(c){var d=c.querySelector("input:not([disabled])");if(d&&a.rules[d.name]){var e={el:d,errField:c.querySelector("[data-field-error]"),holder:c,rules:"required"===b.rules[d.name]?{required:!0}:b.rules[d.name],valid:null};a.formInputs.push(e)}})}},{key:"mapErrors",value:function(){var a=this;this.errorPlacement?this.mapForErrorPlacement():this.errorList.forEach(function(b){var c=a.formInputs[b.inputIndex],d=c.holder;a.addErrorClass(d),a.addErrorMessage(c,b)})}},{key:"mapForErrorPlacement",value:function(){var a=this,c=[];this.formInputs.forEach(function(d){var f=b.where(a.errorList,{el:d.el});if(f.length){var e=b.where(f,{rule:"required"});e.length?c.push(e[0]):c.push(f[0])}}),c.forEach(function(b){a.errorPlacement.call(a,a.getError(b),b.el)})}},{key:"onSubmit",value:function(a){a.preventDefault(),this.validate().hasError?this.invalidHandler&&this.invalidHandler.call(this,this):this.submitHandler?this.submitHandler.call(this,this.form):a.currentTarget.submit()}},{key:"removeErrorClass",value:function(a){a.classList.contains(this.errorClass)&&a.classList.remove(this.errorClass)}},{key:"validateInput",value:function(a,c,d){var f=this,g=a,h=c;if(!c&&"number"!=typeof c){var e=b.findIndex(this.formInputs,{el:g});g=this.formInputs[e],h=e}return Object.entries(g.rules).forEach(function(a){var c=b.findIndex(f.errorList,{el:g.el,rule:a[0],inputIndex:h}),d=b.findIndex(f.errorList,{el:g.el,inputIndex:h});f.validateValue(g.el.value,a[0],a[1])?(0<=c&&f.clearError(h,a[0]),0>d&&(g.valid=!0)):0>c&&(g.valid=!1,f.errorList.push({el:g.el,rule:a[0],required:a[1],inputIndex:h}))}),"function"==typeof d&&d(),g}},{key:"validateValue",value:function(a,b,c){return n[b].call(this,a,c)}},{key:"validate",value:function(){return this.formInputs=this.formInputs.map(this.validateInput.bind(this)),0<this.errorList.length?(this.mapErrors(),{hasError:!0,errorCount:this.errorList.length}):{hasError:!1}}},{key:"setupListeners",value:function(a){var c=this,d=this;Array.from(this.form.querySelectorAll("[data-field-holder]")).forEach(function(f){var g=f.querySelector("input:not([disabled])");0<=b.findIndex(c.formInputs,{el:g})&&g.addEventListener(a,d.validateInput.bind(d,g,null,function(){0<d.errorList.length&&d.mapErrors()}))})}},{key:"setup",value:function(){this.form.addEventListener("submit",this.onSubmit.bind(this)),this.onfocusout&&this.setupListeners("focusout")}}],[{key:"removeErrorMessage",value:function(a){var b=a;b.innerHTML&&b.dataset.inputError&&(b.innerHTML="",b.dataset.inputError="")}}]),a}()});
