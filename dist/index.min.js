!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("underscore")):"function"==typeof define&&define.amd?define(["exports","underscore"],b):b(a.index={},a._)}(this,function(b,g){"use strict";function j(a){var b=2,c=a.split("").reduce(function(a,b){return[parseInt(b,10)].concat(a)},[]).reduce(function(a,c){return a+=c*b,b=9==b?2:b+1,a},0)%11;return 2>c?0:11-c}g=g&&g.hasOwnProperty("default")?g.default:g;var d={cep:"CEP inv\xE1lido.",cpf:"CPF inv\xE1lido.",cnpj:"CNPJ inv\xE1lido.",digits:"Apenas d\xEDgitos permitidos.",email:"Email inv\xE1lido.",required:"Campo obrigat\xF3rio.",minlength:function(a){return"O campo deve ter no minimo "+a+" caracteres"},maxlength:function(a){return"O campo deve ter no m\xE1ximo "+a+" caracteres"}},e=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),k=["00000000000","11111111111","22222222222","33333333333","44444444444","55555555555","66666666666","77777777777","88888888888","99999999999"],m=function(a){var b=a.length+1,c=a.map(function(a,c){return a*(b-c)}).reduce(function(a,b){return a+b})%11;return 1>=c?0:11-c},a=function(a){var b=a.toString().replace(/\D/g,"");if(11!=b.length||k.includes(b))return!1;var c=b.split("").map(function(a){return parseInt(a,10)}),d=c.slice(0,9),e=c.slice(9,2),f=m(d);return[f,m([].concat(function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(d),[f]))].join==e.join},o=["00000000000000","11111111111111","22222222222222","33333333333333","44444444444444","55555555555555","66666666666666","77777777777777","88888888888888","99999999999999"],p=/[-\/.]/g,l=/[^\d]/g,c=function(a,b){var c,d=(c=b?p:l,(a||"").toString().replace(c,""));if(!d)return!1;if(14!==d.length)return!1;if(o.includes(d))return!1;var e=d.substr(0,12);return e+=j(e),(e+=j(e)).substr(-2)===d.substr(-2)},i={cep:function(a){return /^[0-9]{5}(?:-[0-9]{3})?$/.test(a)},cpf:function(b){return a(b)},cnpj:function(a){return c(a)},email:function(a){return /^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(a)},equalTo:function(a,b){var c=this.form.querySelector(b);return!!c&&a===c.value},digits:function(a){return /^[0-9]*$/.test(a)},required:function(a,b){return a&&b},minlength:function(a,b){return 1<=b&&a.length>=b},maxlength:function(a,b){return 1<=b&&a.length<=b}},f=d,h=function(){function a(b,c){!function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}(this,a),this.form=b,this.formInputs=[],this.customRules=c.customRules?c.customRules:{},this.validationMessages=f,this.validationHandlers=i,this.submitEventIntercept=c.submitEventIntercept?c.submitEventIntercept:null,this.fieldHolderSelector=c.fieldHolderSelector?c.fieldHolderSelector:"[data-field-holder]",this.rules=c.rules?c.rules:{},this.errorList=[],this.errorClass=c.errorClass?c.errorClass:"invalid",this.messages=c.messages?c.messages:{},this.onfocusout=c.onfocusout?c.onfocusout:null,this.beforeErrorPlacement=c.beforeErrorPlacement?c.beforeErrorPlacement:null,this.errorPlacement=c.errorPlacement?c.errorPlacement:null,this.submitHandler=c.submitHandler?c.submitHandler:null,this.invalidHandler=c.invalidHandler?c.invalidHandler:null,this.submitListenerHandler=this.onSubmit.bind(this),this.rules||this.setupRules(),this.listInputs(),this.init()}return e(a,[{key:"addCustomRule",value:function(a,b){if(!this.customRules[a]){if("function"!=typeof b)throw new Error("The second param to \"addCustomRule\" should be a function!");this.customRules[a]=b}}},{key:"addCustomRuleMessage",value:function(a,b){if(!this.validationMessages[a]){if("string"!=typeof b&&"function"!=typeof b)throw new Error("The second param to \"addCustomRuleMessage\" should be a string or a function!");this.validationMessages[a]=b}}},{key:"addError",value:function(a,b){a.classList.contains(this.errorClass)||(a.classList.add(this.errorClass),b.setAttribute("aria-invalid","true"))}},{key:"addErrorMessage",value:function(a,b){var c=a.errField,d=this.getError(b,a.el.name);c.innerHTML&&"required"!==d.rule||(c.dataset.inputError=d.rule,c.innerHTML=d.message)}},{key:"clearError",value:function(b,c){var d=g.findIndex(this.errorList,{rule:c,inputIndex:b});if("number"==typeof d){var e=this.formInputs[b];this.removeError(e.holder,e.el),a.removeErrorMessage(e.errField),this.errorList.splice(d,1)}}},{key:"clearErrors",value:function(){var b=this;this.errorPlacement||this.errorList.forEach(function(c){var d=b.formInputs[c.inputIndex],e=d.el,f=d.holder;b.removeError(f,e),a.removeErrorMessage(d.errField)}),this.errorList=[]}},{key:"destroy",value:function(){return this.form.removeEventListener("submit",this.submitListenerHandler),this.clearErrors(),this.formInputs=[],null}},{key:"getError",value:function(a){var b={rule:a.rule};return b.message="function"==typeof this.validationMessages[a.rule]?this.validationMessages[a.rule](a.required):this.validationMessages[a.rule],this.messages&&this.messages[a.el.name]&&this.messages[a.el.name][a.rule]&&(b.message=this.messages[a.el.name][a.rule]),b}},{key:"listInputs",value:function(){var a=this,b=this;Array.from(this.form.querySelectorAll(this.fieldHolderSelector)).forEach(function(c){var d=c.querySelector("input:not([disabled])")||c.querySelector("textarea:not([disabled])");if(d&&a.rules[d.name]){var e={el:d,errField:c.querySelector("[data-field-error]"),holder:c,rules:"required"===b.rules[d.name]?{required:!0}:b.rules[d.name],valid:null};a.formInputs.push(e)}})}},{key:"mapErrors",value:function(){var a=this;this.errorPlacement?this.mapForErrorPlacement():this.errorList.forEach(function(b){var c=a.formInputs[b.inputIndex],d=c.el,e=c.holder;a.addError(e,d),a.addErrorMessage(c,b)})}},{key:"mapForErrorPlacement",value:function(){var a=this,b=[];this.formInputs.forEach(function(c){var d=g.where(a.errorList,{el:c.el});if(d.length){var e=g.where(d,{rule:"required"});e.length?b.push(e[0]):b.push(d[0])}}),this.beforeErrorPlacement&&this.beforeErrorPlacement.call(this,this),b.forEach(function(b){a.errorPlacement.call(a,a.getError(b),b.el)})}},{key:"onSubmit",value:function(a){a.preventDefault(),this.submitEventIntercept&&this.submitEventIntercept.call(this,a,this),this.validate().hasError?this.invalidHandler&&this.invalidHandler.call(this,this):this.submitHandler?this.submitHandler.call(this,this.form):a.currentTarget.submit()}},{key:"removeError",value:function(a,b){a.classList.contains(this.errorClass)&&(b.setAttribute("aria-invalid","false"),a.classList.remove(this.errorClass))}},{key:"validateInput",value:function(a,b,c){var d=this,f=a,h=b;if(!b&&"number"!=typeof b){var e=g.findIndex(this.formInputs,{el:f});f=this.formInputs[e],h=e}return Object.entries(f.rules).forEach(function(a){var b=g.findIndex(d.errorList,{el:f.el,rule:a[0],inputIndex:h}),c=g.findIndex(d.errorList,{el:f.el,inputIndex:h});d.validateValue(f.el.value,a[0],a[1])?(0<=b&&d.clearError(h,a[0]),0>c&&(f.valid=!0)):0>b&&(f.valid=!1,d.errorList.push({el:f.el,rule:a[0],required:a[1],inputIndex:h}))}),"function"==typeof c&&c(),f}},{key:"validateValue",value:function(a,b,c){if(this.validationHandlers[b])return this.validationHandlers[b].call(this,a,c);if(this.customRules[b])return this.customRules[b].call(this,a,c);throw new Error("Undefined rule "+b+".")}},{key:"validate",value:function(){return this.formInputs=this.formInputs.map(this.validateInput.bind(this)),0<this.errorList.length?(this.mapErrors(),{hasError:!0,errorCount:this.errorList.length}):{hasError:!1}}},{key:"setupListeners",value:function(a){var b=this,c=this;Array.from(this.form.querySelectorAll(this.fieldHolderSelector)).forEach(function(d){var e=d.querySelector("input:not([disabled])");0<=g.findIndex(b.formInputs,{el:e})&&e.addEventListener(a,c.validateInput.bind(c,e,null,function(){0<c.errorList.length&&c.mapErrors()}))})}},{key:"init",value:function(){this.form.addEventListener("submit",this.submitListenerHandler),this.onfocusout&&this.setupListeners("focusout"),this.onkeypress&&this.setupListeners("keypress")}}],[{key:"removeErrorMessage",value:function(a){a&&a.innerHTML&&a.dataset.inputError&&(a.innerHTML="",a.dataset.inputError="")}}]),a}();b.default=h,b.defaultMessages=d,b.validationRules=i,Object.defineProperty(b,"__esModule",{value:!0})});
